@model ECommerce.Shared.DTOs.Product.CreateProductDto

@{
    ViewBag.Title = "Create Product";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        Create New Product
                    </h3>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()


                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-8">
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                                <!-- Product Name -->
                                <div class="form-group">
                                    <label asp-for="Name" class="form-label"></label>
                                    <input asp-for="Name" class="form-control" />
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>

                                <!-- Supplier -->
                                <div class="form-group">
                                    <label asp-for="SupplierID" class="form-label">Supplier</label>
                                    <select asp-for="SupplierID" asp-items="ViewBag.SupplierID" class="form-control">
                                        <option value="">-- Select Supplier --</option>
                                    </select>
                                    <span asp-validation-for="SupplierID" class="text-danger"></span>
                                </div>

                                <!-- Category -->
                                <div class="form-group">
                                    <label asp-for="CategoryID" class="form-label">Category</label>
                                    <select asp-for="CategoryID" asp-items="ViewBag.CategoryID" class="form-control">
                                        <option value="">-- Select Category --</option>
                                    </select>
                                    <span asp-validation-for="CategoryID" class="text-danger"></span>
                                </div>

                                <!-- Sub Category -->
                                <div class="form-group">
                                    <label asp-for="SubCategoryID" class="form-label">SubCategory</label>
                                    <select asp-for="SubCategoryID" asp-items="ViewBag.SubCategoryID"
                                        class="form-control">
                                        <option value="">-- Select Sub Category --</option>
                                    </select>
                                    <span asp-validation-for="SubCategoryID" class="text-danger"></span>
                                </div>

                                <!-- Prices -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="UnitPrice" class="form-label"></label>
                                            <input asp-for="UnitPrice" class="form-control" type="number" step="0.01" />
                                            <span asp-validation-for="UnitPrice" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="OldPrice" class="form-label"></label>
                                            <input asp-for="OldPrice" class="form-control" type="number" step="0.01" />
                                            <span asp-validation-for="OldPrice" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quantity Per Unit -->
                                <div class="form-group">
                                    <label asp-for="QuantityPerUnit" class="form-label"></label>
                                    <input asp-for="QuantityPerUnit" class="form-control" />
                                    <span asp-validation-for="QuantityPerUnit" class="text-danger"></span>
                                </div>

                                <!-- Unit Weight and Size -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="UnitWeight" class="form-label"></label>
                                            <input asp-for="UnitWeight" class="form-control" />
                                            <span asp-validation-for="UnitWeight" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="Size" class="form-label"></label>
                                            <input asp-for="Size" class="form-control" />
                                            <span asp-validation-for="Size" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Stock and Order Info -->
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="Discount" class="form-label"></label>
                                            <input asp-for="Discount" class="form-control" type="number" step="0.01" />
                                            <span asp-validation-for="Discount" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="UnitInStock" class="form-label"></label>
                                            <input asp-for="UnitInStock" class="form-control" type="number" />
                                            <span asp-validation-for="UnitInStock" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="UnitOnOrder" class="form-label"></label>
                                            <input asp-for="UnitOnOrder" class="form-control" type="number" />
                                            <span asp-validation-for="UnitOnOrder" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Product Status -->
                                <div class="form-group">
                                    <div class="form-check">
                                        <input asp-for="ProductAvailable" class="form-check-input" type="checkbox" />
                                        <label asp-for="ProductAvailable" class="form-check-label"></label>
                                    </div>
                                </div>
                                <!-- Badge Info -->
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input asp-for="AddBadge" class="form-check-input" type="checkbox" />
                                            <label asp-for="AddBadge" class="form-check-label"></label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="OfferTitle" class="form-label"></label>
                                            <input asp-for="OfferTitle" class="form-control" />
                                            <span asp-validation-for="OfferTitle" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label asp-for="OfferBadgeClass" class="form-label"></label>
                                            <input asp-for="OfferBadgeClass" class="form-control" />
                                            <span asp-validation-for="OfferBadgeClass" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Description Fields -->
                                <div class="form-group">
                                    <label asp-for="ShortDescription" class="form-label"></label>
                                    <textarea asp-for="ShortDescription" class="form-control" rows="3"></textarea>
                                    <span asp-validation-for="ShortDescription" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="LongDescription" class="form-label"></label>
                                    <textarea asp-for="LongDescription" class="form-control" rows="5"></textarea>
                                    <span asp-validation-for="LongDescription" class="text-danger"></span>
                                </div>                                
                                <!-- Picture Fields -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="Picture1File" class="form-label">Upload Picture 1</label>
                                            <input asp-for="Picture1File" class="form-control" type="file" accept="image/*" />
                                            <small class="form-text text-muted">Select image file from your computer</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="Picture2File" class="form-label">Upload Picture 2</label>
                                            <input asp-for="Picture2File" class="form-control" type="file" accept="image/*" />
                                            <small class="form-text text-muted">Select image file from your computer</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="Picture3File" class="form-label">Upload Picture 3</label>
                                            <input asp-for="Picture3File" class="form-control" type="file" accept="image/*" />
                                            <small class="form-text text-muted">Select image file from your computer</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label asp-for="Picture4File" class="form-label">Upload Picture 4</label>
                                            <input asp-for="Picture4File" class="form-control" type="file" accept="image/*" />
                                            <small class="form-text text-muted">Select image file from your computer</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Note -->
                                <div class="form-group">
                                    <label asp-for="Note" class="form-label"></label>
                                    <textarea asp-for="Note" class="form-control" rows="3"></textarea>
                                    <span asp-validation-for="Note" class="text-danger"></span>
                                </div>                                <!-- Buttons -->
                                <div class="form-group mt-3">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa fa-save"></i> Create Product
                                    </button>
                                    <a asp-action="Index" class="btn btn-secondary">
                                        <i class="fa fa-arrow-left"></i> Back to List
                                    </a>
                                </div>
                            </div>                            
                            <!-- Right Column - Image Preview -->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Product Image Preview</label>
                                    <div class="text-center">
                                        <img id="imagePreview" src="~/images/no-image.png" 
                                             alt="Product Image" class="img-thumbnail mb-2" 
                                             style="width: 200px; height: 200px; object-fit: cover;">
                                    </div>
                                    
                                    <!-- Image Upload -->
                                    <div class="form-group mt-3">
                                        <label asp-for="ImageFile" class="form-label">Upload Main Image</label>
                                        <input asp-for="ImageFile" class="form-control" type="file" accept="image/*" id="mainImageFile" />
                                        <small class="form-text text-muted">Select image file from your computer</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label asp-for="AltText" class="form-label">Alt Text</label>
                                        <input asp-for="AltText" class="form-control" placeholder="Describe the image" />
                                        <span asp-validation-for="AltText" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                          </div>  
                      </form>  
                  </div>  
              </div>  
          </div>  
      </div>  
  </div>
  @section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            // Image preview from file upload
            $('#mainImageFile').on('change', function(e) {
                var file = e.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $('#imagePreview').attr('src', e.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    $('#imagePreview').attr('src', '/images/no-image.png');
                }
            });

            // Category change event for subcategory filtering
            $('#CategoryID').change(function() {
                var categoryId = $(this).val();
                if (categoryId) {
                    // AJAX call to get subcategories by category
                    $.get('/Product/GetSubCategoriesByCategory', { categoryId: categoryId }, function(data) {
                        $('#SubCategoryID').empty().append('<option value="">-- Select SubCategory --</option>');
                        $.each(data, function(i, item) {
                            $('#SubCategoryID').append('<option value="' + item.value + '">' + item.text + '</option>');
                        });
                    });
                } else {
                    $('#SubCategoryID').empty().append('<option value="">-- Select SubCategory --</option>');
                }
            });
        });
    </script>
}



